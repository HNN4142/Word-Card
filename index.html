  <script>
    const wordDB = JSON.parse(localStorage.getItem('wordDB') || '{}');
    const searchCounts = JSON.parse(localStorage.getItem('searchCounts') || '{}');

    function saveDB() {
      localStorage.setItem('wordDB', JSON.stringify(wordDB));
    }

    function saveCounts() {
      localStorage.setItem('searchCounts', JSON.stringify(searchCounts));
    }

    function addWord() {
      const word = document.getElementById('wordInput').value.trim();
      const meaningEn = document.getElementById('meaningEn').value.trim();
      const meaningJa = document.getElementById('meaningJa').value.trim();
      const example = document.getElementById('example').value.trim();
      const phonetic = document.getElementById('phonetic').value.trim();

      if (!word) return alert('Word is required.');

      wordDB[word] = { meaningEn, meaningJa, example, phonetic };
      saveDB();
      displayWords();
    }

    function importWords() {
      const fileInput = document.getElementById('importFile');
      const file = fileInput.files[0];
      if (!file) return alert('Please select a JSON file to import.');

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const imported = JSON.parse(e.target.result);
          for (const word in imported) {
            wordDB[word] = imported[word];
          }
          saveDB();
          displayWords();
          alert('Import successful!');
        } catch (error) {
          alert('Invalid JSON format.');
        }
      };
      reader.readAsText(file);
    }

    function displayWords() {
      const list = document.getElementById('wordList');
      list.innerHTML = '';
      Object.keys(wordDB).sort().forEach(word => {
        const data = wordDB[word];
        const count = searchCounts[word] || 0;
        const div = document.createElement('div');
        div.className = 'entry';
        div.innerHTML = `
          <strong>${word}</strong> (${count} searches)<br>
          <em>${data.phonetic}</em><br>
          <strong>EN:</strong> ${data.meaningEn}<br>
          <strong>JA:</strong> ${data.meaningJa}<br>
          <strong>Example:</strong> ${data.example}
          <div class="entry-buttons">
            <button onclick="editWord('${word}')">‚úèÔ∏è Edit</button>
            <button onclick="deleteWord('${word}')">üóë Delete</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    function deleteWord(word) {
      delete wordDB[word];
      delete searchCounts[word];
      saveDB();
      saveCounts();
      displayWords();
    }

    function editWord(word) {
      const data = wordDB[word];
      document.getElementById('wordInput').value = word;
      document.getElementById('meaningEn').value = data.meaningEn;
      document.getElementById('meaningJa').value = data.meaningJa;
      document.getElementById('example').value = data.example;
      document.getElementById('phonetic').value = data.phonetic;
      delete wordDB[word];
      saveDB();
      window.scrollTo({ top: 0, behavior: 'smooth' }); // ‚Üê „Çπ„ÇØ„É≠„Éº„É´ËøΩÂä†
    }

    function searchWord() {
      const word = document.getElementById('searchInput').value.trim();
      if (!word) return;
      searchCounts[word] = (searchCounts[word] || 0) + 1;
      saveCounts();
      const count = searchCounts[word];
      document.getElementById('searchCount').innerText = `"${word}" has been searched ${count} time(s).`;

      const display = document.getElementById('searchResultDisplay');
      if (wordDB[word]) {
        const data = wordDB[word];
        display.innerHTML = `
          <div class="search-display-box">
            <strong>${word}</strong> (${count} searches)<br>
            <em>${data.phonetic}</em><br>
            <strong>EN:</strong> ${data.meaningEn}<br>
            <strong>JA:</strong> ${data.meaningJa}<br>
            <strong>Example:</strong> ${data.example}
          </div>
        `;
      } else {
        display.innerHTML = `<p>No matching word found in your library.</p>`;
      }

      displayWords();
    }

    function resetData() {
      if (confirm("Are you sure you want to delete all data?")) {
        localStorage.removeItem('wordDB');
        localStorage.removeItem('searchCounts');
        location.reload();
      }
    }

    window.onload = displayWords;
  </script>
</body>
</html>
